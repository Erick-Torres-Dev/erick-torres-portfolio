name: CI - ValidaÃ§Ã£o de Pull Request

on:
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
    - name: ðŸ“¥ Checkout do cÃ³digo
      uses: actions/checkout@v4

    - name: ðŸ” Verificar existÃªncia de index.html
      run: |
        if [ ! -f "index.html" ]; then
          echo "ERRO: Arquivo index.html nao encontrado na raiz do projeto!"
          exit 1
        fi
        echo "OK: index.html encontrado com sucesso!"

    - name: ðŸ”Ž Verificar nomes de arquivo invÃ¡lidos
      run: |
        if find . -type f \( -name "index-*.html" -o -name "home.html" \) | grep -q .; then
          echo "ERRO: Arquivos HTML com nome invalido encontrados!"
          exit 1
        fi
        echo "OK: Nomes de arquivo validos!"

    - name: ðŸ’¾ Verificar tamanho dos arquivos (mÃ¡x 500KB)
      run: |
        echo "Verificando tamanho dos arquivos..."
        FILES=$(find . -type f -size +500k)
        if [ ! -z "$FILES" ]; then
          echo "ERRO: Arquivos maiores que 500KB encontrados:"
          echo "$FILES"
          exit 1
        fi
        echo "OK: Todos os arquivos estao dentro do limite de 500KB!"

    - name: ðŸ“ Verificar comentÃ¡rios e termos sensÃ­veis
      run: |
        echo "Verificando codigo em busca de TODO, FIXME, senha e password..."
        if grep -r "TODO\|FIXME\|senha\|password" --include="*.html" --include="*.js" --include="*.css" . 2>/dev/null; then
          echo "ERRO: Comentarios ou termos sensiveis encontrados!"
          exit 1
        fi
        echo "OK: Nenhum comentario ou termo sensivel encontrado!"

    - name: ðŸ”— Verificar validade de links HTML
      run: |
        echo "Verificando tags HTML (links e imagens)..."
        if grep -E '<img[^>]*src="[^"]*"[^>]*>' index.html | grep -E 'src=""' >/dev/null; then
          echo "ERRO: Tag img encontrada com src vazio!"
          exit 1
        fi
        if grep -E '<a[^>]*href="[^"]*"[^>]*>' index.html | grep -E 'href=""' >/dev/null; then
          echo "ERRO: Tag a encontrada com href vazio!"
          exit 1
        fi
        echo "OK: Todos os links e imagens estao validos!"

    - name: ðŸ“¦ Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}

    - name: ðŸ“œ Instalar HTML Linter
      run: npm install -g htmlhint

    - name: ðŸ”§ Executar Linter no HTML
      run: |
        echo "Executando HTMLHint para validacao de codigo..."
        htmlhint index.html || true
        echo "OK: Validacao de HTML concluida!"

    - name: ðŸŽ‰ ValidaÃ§Ã£o concluÃ­da com sucesso!
      run: echo "OK: Todos os testes passaram com sucesso!"
